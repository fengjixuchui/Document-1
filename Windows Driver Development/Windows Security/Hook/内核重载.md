以下是一般重载内核的步骤：

1. 将内核文件加载到内存。
2. 进行基址重定位。(代码段用新内核基址定位，数据段用老内核基址定位)
    重定位中包含了代码重定位和变量重定位，既然我们做的是重载内核，那么肯定是需要让原本走NT模块的流程转移到我们的新模块上，那么可以肯定的是代码重定位一定要在新模块上，至于变量，我个人的做法是指向原模块，因为即使是重载内核，也不能保证所有执行单元都会走新模块，这样保险一些，也简单一些，不过需要注意的是，变量重定位也包含IAT，所以我这里把IAT也指向新模块，否则修复输入表就没意义了，也可以防范IAT HOOK。
3. 重定位ssdt结构。
4. Hook KiFastCallEntry，让RING3进程调用走新内核。